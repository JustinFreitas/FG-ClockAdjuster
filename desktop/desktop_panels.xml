<?xml version="1.0" encoding="iso-8859-1"?>

<!-- Please see the LICENSE.md file included with this distribution for attribution and copyright information. -->

<root version="3.0">	
	<panel name="date" modes="host">
		<class>chattime</class>
        <anchored>
            <left>
                <anchor>left</anchor>
                <offset>100</offset>
            </left>
            <top>
                <anchor>top</anchor>
                <offset>100</offset>
            </top>
            <size>
                <width>260</width>
                <height>99</height>
            </size>
        </anchored>
		<dynamic />
		<locked />
	</panel>

	<windowclass name="chattime">
		<frame>recordsheet</frame>
		<noclose />
        <sizelimits>
            <!-- Force old implementations into new size -->
            <minimum>
                <width>260</width>
                <height>99</height>
            </minimum>
            <maximum>
                <width>260</width>
                <height>99</height>
            </maximum>
        </sizelimits>
		<sheetdata>
			<genericcontrol name="topleftanchor">
				<anchored>
					<top />
					<left />
                    <size>
                        <width>0</width>
                        <height>0</height>
                    </size>
				</anchored>
				<invisible />
			</genericcontrol>
			<label name="title">
				<anchored>
                    <left>
                        <parent>topleftanchor</parent>
                        <anchor>right</anchor>
                        <offset>11</offset>
                    </left>
                    <top>
                        <parent>topleftanchor</parent>
                        <anchor>bottom</anchor>
                        <offset>8</offset>
                    </top>
                    <size>
                        <width>210</width>
                        <height>18</height>
                    </size>
				</anchored>
                <static>Clock Adjuster v2.4.6 FGC/FGU</static>
				<script>
					function onDoubleClick()
						TimeManager.outputDateAndTime();
					end
				</script>
			</label>
			<buttoncontrol name="showdatetime">
				<anchored>
                    <left>
                        <parent>title</parent>
                        <anchor>right</anchor>
                        <offset>12</offset>
                    </left>
                    <top>
                        <parent>title</parent>
                        <anchor>top</anchor>
                        <offset>0</offset>
                    </top>
                    <size>
                        <width>18</width>
                        <height>18</height>
                    </size>
				</anchored>
				<icon normal="today" pressed="today_down" />
				<tooltip text="Click to output current game date and time to chat" />
				<script>
					function onButtonPress()
						TimeManager.outputDateAndTime();
					end
				</script>
			</buttoncontrol>
			<label name="currenthour">
				<anchored>
                    <left>
                        <parent>title</parent>
                        <anchor>left</anchor>
                        <offset>2</offset>
                    </left>
                    <top>
                        <parent>title</parent>
                        <anchor>bottom</anchor>
                        <offset>2</offset>
                    </top>
                    <size>
                        <width>20</width>
                        <height>16</height>
                    </size>
				</anchored>
				<tooltip textres="desktop_currenthour_tooltip" />
				<frame name="fieldlight" offset="8,5,8,4" />
				<stateframe>
					<hover name="fieldfocus" offset="8,5,8,4" />
				</stateframe>
				<readonly />
				<center />
				<!-- Opening timedevents, timedreminders, and travelmanager in onInit() allows for their
				triggers to work correctly on campaign open, otherwise they don't work until opened manually. -->
				<script>
					function onInit()
						if DB.getValue(TimeManager.CAL_NEWCAMPAIGN, 0) == 0 then
							if DB.getValue(TimeManager.CAL_CUR_YEAR, 0) == 0 then
								DB.setValue(TimeManager.CAL_CUR_YEAR, "number", 1);
							end

							if DB.getValue(TimeManager.CAL_CUR_MONTH, 0) == 0 then
								DB.setValue(TimeManager.CAL_CUR_MONTH, "number", 1);
							end

							if DB.getValue(TimeManager.CAL_CUR_DAY, 0) == 0 then
								DB.setValue(TimeManager.CAL_CUR_DAY, "number", 1);
							end

							if DB.getValue(TimeManager.CAL_CUR_MIN) == nil then
								DB.setValue(TimeManager.CAL_CUR_MIN, "number", 0);
							end

							if DB.getValue(TimeManager.CAL_CUR_HOUR) == nil then
								DB.setValue(TimeManager.CAL_CUR_HOUR, "number", 0);
							end

							Interface.openWindow("calendar", "DB");
							DB.setValue(TimeManager.CAL_NEWCAMPAIGN, "number", 1);
						end

						Interface.openWindow("timedevents", "DB");
						Interface.toggleWindow("timedevents", "DB")
						Interface.openWindow("timedreminders", "DB");
						Interface.toggleWindow("timedreminders", "DB")
						Interface.openWindow("travelmanager", "DB");
						Interface.toggleWindow("travelmanager", "DB")

						DB.addHandler(TimeManager.CAL_CUR_HOUR, "onUpdate", onSourceChanged);
						onSourceChanged();
					end

					function onSourceChanged()
						local nHour, sPhase = CalendarManager.getDisplayHour();
						setValue(string.format("%2d", nHour));
						window.currentphase.setValue(sPhase);
					end

					function onWheel(n)
						if not Input.isControlPressed() then
							return false;
						end

                        TimeManager.bTimeAdvancedByAdvanceTimeButtonPress = true;
						CalendarManager.adjustHours(n);
						return true;
					end
				</script>
			</label>
			<label name="timesep">
				<anchored>
                    <left>
                        <parent>currenthour</parent>
                        <anchor>right</anchor>
                        <offset>7</offset>
                    </left>
                    <top>
                        <parent>currenthour</parent>
                        <anchor>top</anchor>
                        <offset>0</offset>
                    </top>
                    <size>
                        <width>5</width>
                        <height>16</height>
                    </size>
				</anchored>
				<static>:</static>
			</label>
			<label name="currentminute">
				<anchored>
                    <left>
                        <parent>currenthour</parent>
                        <anchor>right</anchor>
                        <offset>18</offset>
                    </left>
                    <top>
                        <parent>currenthour</parent>
                        <anchor>top</anchor>
                        <offset>0</offset>
                    </top>
                    <size>
                        <width>20</width>
                        <height>16</height>
                    </size>
				</anchored>
				<tooltip textres="desktop_currentminute_tooltip" />
				<frame name="fieldlight" offset="8,5,8,4" />
				<stateframe>
					<hover name="fieldfocus" offset="8,5,8,4" />
				</stateframe>
				<readonly />
				<center />
				<script>
					function onInit()
						DB.addHandler(TimeManager.CAL_CUR_MIN, "onUpdate", onSourceChanged);
						onSourceChanged();
					end

					function onSourceChanged()
						setValue(string.format("%02d", DB.getValue(TimeManager.CAL_CUR_MIN, 0)));
					end

					function onWheel(n)
						if not Input.isControlPressed() then
							return false;
						end
						
                        TimeManager.bTimeAdvancedByAdvanceTimeButtonPress = true;
						CalendarManager.adjustMinutes(n);
						return true;
					end
				</script>
			</label>
			<label name="currentphase">
				<anchored>
                    <left>
                        <parent>currentminute</parent>
                        <anchor>right</anchor>
                        <offset>10</offset>
                    </left>
                    <top>
                        <parent>currentminute</parent>
                        <anchor>top</anchor>
                        <offset>0</offset>
                    </top>
                    <size>
                        <width>20</width>
                        <height>16</height>
                    </size>
				</anchored>
				<center />
			</label>
			<label name="currentday">
				<anchored>
                    <left>
                        <parent>currentphase</parent>
                        <anchor>right</anchor>
                        <offset>12</offset>
                    </left>
                    <top>
                        <parent>currentphase</parent>
                        <anchor>top</anchor>
                        <offset>0</offset>
                    </top>
                    <size>
                        <width>20</width>
                        <height>16</height>
                    </size>
				</anchored>
				<tooltip textres="desktop_currentday_tooltip" />
				<frame name="fieldlight" offset="8,5,8,4" />
				<stateframe>
					<hover name="fieldfocus" offset="8,5,8,4" />
				</stateframe>
				<readonly />
				<center />
				<script>
					function onInit()
						DB.addHandler(TimeManager.CAL_CUR_DAY, "onUpdate", onSourceChanged);
						onSourceChanged();
					end

					function onSourceChanged()
						setValue(string.format("%02d", DB.getValue(TimeManager.CAL_CUR_DAY, 0)));
					end

					function onWheel(n)
						if not Input.isControlPressed() then
							return false;
						end
						
                        TimeManager.bTimeAdvancedByAdvanceTimeButtonPress = true;
						CalendarManager.adjustDays(n);
						return true;
					end
				</script>
			</label>
			<label name="currentmonth">
				<anchored>
                    <left>
                        <parent>currentday</parent>
                        <anchor>right</anchor>
                        <offset>14</offset>
                    </left>
                    <top>
                        <parent>currentday</parent>
                        <anchor>top</anchor>
                        <offset>0</offset>
                    </top>
                    <size>
                        <width>20</width>
                        <height>16</height>
                    </size>
				</anchored>
				<tooltip textres="desktop_currentmonth_tooltip" />
				<frame name="fieldlight" offset="8,5,8,4" />
				<stateframe>
					<hover name="fieldfocus" offset="8,5,8,4" />
				</stateframe>
				<readonly />
				<center />
				<script>
					function onInit()
						DB.addHandler(TimeManager.CAL_CUR_MONTH, "onUpdate", onSourceChanged);
						onSourceChanged();
					end

					function onSourceChanged()
						setValue(string.format("%02d", DB.getValue(TimeManager.CAL_CUR_MONTH, 0)));
					end

					function onWheel(n)
						if not Input.isControlPressed() then
							return false;
						end
						
                        TimeManager.bTimeAdvancedByAdvanceTimeButtonPress = true;
						CalendarManager.adjustMonths(n);
						return true;
					end
				</script>
			</label>
			<label name="currentyear">
				<anchored>
                    <left>
                        <parent>currentmonth</parent>
                        <anchor>right</anchor>
                        <offset>14</offset>
                    </left>
                    <top>
                        <parent>currentmonth</parent>
                        <anchor>top</anchor>
                        <offset>0</offset>
                    </top>
                    <size>
                        <width>40</width>
                        <height>16</height>
                    </size>
				</anchored>
				<tooltip textres="desktop_currentyear_tooltip" />
				<frame name="fieldlight" offset="8,5,8,4" />
				<stateframe>
					<hover name="fieldfocus" offset="8,5,8,4" />
				</stateframe>
				<readonly />
				<center />
				<script>
					function onInit()
						DB.addHandler(TimeManager.CAL_CUR_YEAR, "onUpdate", onSourceChanged);
						onSourceChanged();
					end

					function onSourceChanged()
						setValue(string.format("%02d", DB.getValue(TimeManager.CAL_CUR_YEAR, 0)));
					end

					function onWheel(n)
						if not Input.isControlPressed() then
							return false;
						end
						
                        TimeManager.bTimeAdvancedByAdvanceTimeButtonPress = true;
						CalendarManager.adjustYears(n);
						return true;
					end
				</script>
			</label>
			<buttoncontrol name="showcurrentlog">
				<anchored>
                    <left>
                        <parent>showdatetime</parent>
                        <anchor>left</anchor>
                        <offset>0</offset>
                    </left>
                    <top>
                        <parent>showdatetime</parent>
                        <anchor>bottom</anchor>
                        <offset>1</offset>
                    </top>
                    <size>
                        <width>18</width>
                        <height>18</height>
                    </size>
				</anchored>
				<icon normal="doc" pressed="doc_down" />
				<tooltip text="Click to show the current log" />
				<script>
					function onButtonPress()
						local nCurYear = DB.getValue("calendar.current.year", 0);
						local nCurMonth = DB.getValue("calendar.current.month", 0);
						local nCurDay = DB.getValue("calendar.current.day", 0);
						local bFound = false;
						for _,v in pairs(DB.getChildren("calendar.log")) do
							local nYear = DB.getValue(v, "year", 0);
							local nMonth = DB.getValue(v, "month", 0);
							local nDay = DB.getValue(v, "day", 0);
							if nCurYear == nYear and
							   nCurMonth == nMonth and
							   nCurDay == nDay then
							   Interface.toggleWindow("advlogentry", v);
							   bFound = true;
							   break;
							end
						end

						if not bFound then
							local nodeLog = DB.createNode("calendar.log");
							local nodeEvent = nodeLog.createChild();					
							DB.setValue(nodeEvent, "epoch", "string", DB.getValue("calendar.current.epoch", ""));
							DB.setValue(nodeEvent, "year", "number", nCurYear);
							DB.setValue(nodeEvent, "month", "number", nCurMonth);
							DB.setValue(nodeEvent, "day", "number", nCurDay);
							Interface.toggleWindow("advlogentry", nodeEvent);
						end
					end
				</script>
			</buttoncontrol>
			<basicnumber name="addhour" source="addhour">
				<anchored>
                    <left>
                        <parent>currenthour</parent>
                        <anchor>left</anchor>
                        <offset>0</offset>
                    </left>
                    <top>
                        <parent>currenthour</parent>
                        <anchor>bottom</anchor>
                        <offset>5</offset>
                    </top>
                    <size>
                        <width>20</width>
                        <height>16</height>
                    </size>
				</anchored>
				<min>0</min>
				<tooltip textres="desktop_addhour_tooltip" />
				<frame name="fieldlight" offset="8,5,8,4" />
				<stateframe>
					<hover name="fieldfocus" offset="8,5,8,4" />
				</stateframe>
				<script>
					function onInit()
						setValue(tonumber(OptionsManager.getOption(TimeManager.CLOCKADJUSTER_DEFAULT_HOURS)) or 0);
						OptionsManager.registerCallback(TimeManager.CLOCKADJUSTER_DEFAULT_HOURS, onOptionChanged);
					end

					function onOptionChanged()
						setValue(tonumber(OptionsManager.getOption(TimeManager.CLOCKADJUSTER_DEFAULT_HOURS)) or 0);
					end

					function onDoubleClick()
						local nHour = getValue() or 0;
						local nRounds = nHour * 600;
						TimeManager.processTimeRoundsOption(nRounds);
						CalendarManager.adjustHours(nHour);
						TimeManager.checkAndProcessWeather(window.checkweather.getValue());
						TimeManager.checkAndOutputDate();
						if nHour &gt; 0 then 
							CalendarManager.outputTime();
						end

						TimeManager.onUpdateAddControl();
					end
				</script>
			</basicnumber>
			<label name="timesep2">
				<anchored>
                    <left>
                        <parent>timesep</parent>
                        <anchor>left</anchor>
                        <offset>0</offset>
                    </left>
                    <top>
                        <parent>addhour</parent>
                        <anchor>top</anchor>
                        <offset>0</offset>
                    </top>
                    <size>
                        <width>5</width>
                        <height>16</height>
                    </size>
				</anchored>
				<static>:</static>
			</label>
			<basicnumber name="addminute" source="addminute">
				<anchored>
                    <left>
                        <parent>currentminute</parent>
                        <anchor>left</anchor>
                        <offset>0</offset>
                    </left>
                    <top>
                        <parent>addhour</parent>
                        <anchor>top</anchor>
                        <offset>0</offset>
                    </top>
                    <size>
                        <width>20</width>
                        <height>16</height>
                    </size>
				</anchored>
				<min>0</min>
				<tooltip textres="desktop_addminute_tooltip" />
				<frame name="fieldlight" offset="8,5,8,4" />
				<stateframe>
					<hover name="fieldfocus" offset="8,5,8,4" />
				</stateframe>
				<script>
					function onInit()
						setValue(tonumber(OptionsManager.getOption(TimeManager.CLOCKADJUSTER_DEFAULT_MINUTES)) or 0);
						OptionsManager.registerCallback(TimeManager.CLOCKADJUSTER_DEFAULT_MINUTES, onOptionChanged);
					end

					function onOptionChanged()
						setValue(tonumber(OptionsManager.getOption(TimeManager.CLOCKADJUSTER_DEFAULT_MINUTES)) or 0);
					end

					function onDoubleClick()
						local nMinute = getValue() or 0;
						local nRounds = nMinute * 10;
						TimeManager.processTimeRoundsOption(nRounds);
						CalendarManager.adjustMinutes(nMinute);
						TimeManager.checkAndOutputDate();
						if nMinute &gt; 0 then 
							CalendarManager.outputTime(); 
						end

						TimeManager.onUpdateAddControl();
					end
				</script>
			</basicnumber>
			
			<basicnumber name="addday" source="addday">
				<anchored>
                    <left>
                        <parent>currentday</parent>
                        <anchor>left</anchor>
                        <offset>0</offset>
                    </left>
                    <top>
                        <parent>currentday</parent>
                        <anchor>bottom</anchor>
                        <offset>4</offset>
                    </top>
                    <size>
                        <width>20</width>
                        <height>16</height>
                    </size>
				</anchored>
				<min>0</min>
				<tooltip textres="desktop_addday_tooltip" />
				<frame name="fieldlight" offset="8,5,8,4" />
				<stateframe>
					<hover name="fieldfocus" offset="8,5,8,4" />
				</stateframe>
				<script>
					function onInit()
						setValue(tonumber(OptionsManager.getOption(TimeManager.CLOCKADJUSTER_DEFAULT_DAYS)) or 0);
						OptionsManager.registerCallback(TimeManager.CLOCKADJUSTER_DEFAULT_DAYS, onOptionChanged);
					end

					function onOptionChanged()
						setValue(tonumber(OptionsManager.getOption(TimeManager.CLOCKADJUSTER_DEFAULT_DAYS)) or 0);
					end

					function onDoubleClick()
						local nDay = getValue() or 0;
						local nRounds = nDay * 14400;
						TimeManager.processTimeRoundsOption(nRounds);
						CalendarManager.adjustDays(nDay);
						TimeManager.checkAndProcessWeather(window.checkweather.getValue());
						if nDay &gt; 0 then 
							CalendarManager.outputDate(); 
						end

						TimeManager.onUpdateAddControl();
					end
				</script>
			</basicnumber>
			<basicnumber name="addmonth" source="addmonth">
				<anchored>
                    <left>
                        <parent>currentmonth</parent>
                        <anchor>left</anchor>
                        <offset>0</offset>
                    </left>
                    <top>
                        <parent>currentmonth</parent>
                        <anchor>bottom</anchor>
                        <offset>4</offset>
                    </top>
                    <size>
                        <width>20</width>
                        <height>16</height>
                    </size>
				</anchored>
				<min>0</min>
				<tooltip textres="desktop_addmonth_tooltip" />
				<frame name="fieldlight" offset="8,5,8,4" />
				<stateframe>
					<hover name="fieldfocus" offset="8,5,8,4" />
				</stateframe>
				<script>
					function onInit()
						setValue(tonumber(OptionsManager.getOption(TimeManager.CLOCKADJUSTER_DEFAULT_MONTHS)) or 0);
						OptionsManager.registerCallback(TimeManager.CLOCKADJUSTER_DEFAULT_MONTHS, onOptionChanged);
					end

					function onOptionChanged()
						setValue(tonumber(OptionsManager.getOption(TimeManager.CLOCKADJUSTER_DEFAULT_MONTHS)) or 0);
					end

					function onDoubleClick()
						local nMonth = getValue() or 0;
						local nRounds = nMonth * 403200;
						TimeManager.processTimeRoundsOption(nRounds);
						CalendarManager.adjustMonths(nMonth);
						TimeManager.checkAndProcessWeather(window.checkweather.getValue());
						if nMonth &gt; 0 then 
							CalendarManager.outputDate(); 
						end

						TimeManager.onUpdateAddControl();
					end
				</script>
			</basicnumber>
			<basicnumber name="addyear" source="addyear">
				<anchored>
                    <left>
                        <parent>currentyear</parent>
                        <anchor>left</anchor>
                        <offset>0</offset>
                    </left>
                    <top>
                        <parent>currentyear</parent>
                        <anchor>bottom</anchor>
                        <offset>4</offset>
                    </top>
                    <size>
                        <width>40</width>
                        <height>16</height>
                    </size>
				</anchored>
				<min>0</min>
				<tooltip textres="desktop_addyears_tooltip" />
				<frame name="fieldlight" offset="8,5,8,4" />
				<stateframe>
					<hover name="fieldfocus" offset="8,5,8,4" />
				</stateframe>
				<script>
					function onInit()
						setValue(tonumber(OptionsManager.getOption(TimeManager.CLOCKADJUSTER_DEFAULT_YEARS)) or 0);
						OptionsManager.registerCallback(TimeManager.CLOCKADJUSTER_DEFAULT_YEARS, onOptionChanged);
					end

					function onOptionChanged()
						setValue(tonumber(OptionsManager.getOption(TimeManager.CLOCKADJUSTER_DEFAULT_YEARS)) or 0);
					end

					function onDoubleClick()
						local nYear = window.addyear.getValue() or 0;
						CalendarManager.adjustYears(nYear);
						TimeManager.checkAndProcessWeather(window.checkweather.getValue());
						if nYear &gt; 0 then 
							CalendarManager.outputDate(); 
						end

						TimeManager.onUpdateAddControl();
					end
				</script>
			</basicnumber>
			<buttoncontrol name="showalllogs">
				<anchored>
                    <left>
                        <parent>showcurrentlog</parent>
                        <anchor>left</anchor>
                        <offset>0</offset>
                    </left>
                    <top>
                        <parent>showcurrentlog</parent>
                        <anchor>bottom</anchor>
                        <offset>2</offset>
                    </top>
                    <size>
                        <width>18</width>
                        <height>18</height>
                    </size>
				</anchored>
				<icon normal="all_logs" pressed="all_logs_down" />
				<tooltip text="Click to show all logs" />
				<script>
					function onButtonPress()
						Interface.toggleWindow("loglist", "calendar.log");
					end
				</script>
			</buttoncontrol>
			
			<label name="addall">
				<anchored>
                    <left>
                        <parent>addminute</parent>
                        <anchor>right</anchor>
                        <offset>8</offset>
                    </left>
                    <top>
                        <parent>addminute</parent>
                        <anchor>top</anchor>
                        <offset>0</offset>
                    </top>
                    <size>
                        <width>25</width>
                        <height>16</height>
                    </size>
				</anchored>
				<static textres="desktop_panel_add" />
				<tooltip textres="desktop_addall_tooltip" />
				<script>
					function onDoubleClick()
						local nMinute = window.addminute.getValue() or 0;
						local nHour = window.addhour.getValue() or 0;
						local nDay = window.addday.getValue() or 0;
						local nMonth = window.addmonth.getValue() or 0;
						local nYear = window.addyear.getValue() or 0;
						local nRounds = (nHour * 600) + (nMinute * 10) + (nDay * 14400) + (nMonth * 403200);
						TimeManager.processTimeRoundsOption(nRounds);
						TimeManager.checkAndProcessWeather(window.checkweather.getValue());
						CalendarManager.adjustMinutes(nMinute);
						CalendarManager.adjustHours(nHour);
						CalendarManager.adjustDays(nDay);
						CalendarManager.adjustMonths(nMonth);
						CalendarManager.adjustYears(nYear);
						CalendarManager.outputDate();
						CalendarManager.outputTime();
						TimeManager.onUpdateAddControl();
					end
				</script>
				<center />
			</label>
			
			<basicnumber name="longrest">
				<anchored>
                    <left>
                        <parent>addhour</parent>
                        <anchor>left</anchor>
                        <offset>0</offset>
                    </left>
                    <top>
                        <parent>addhour</parent>
                        <anchor>bottom</anchor>
                        <offset>6</offset>
                    </top>
                    <size>
                        <width>20</width>
                        <height>16</height>
                    </size>
				</anchored>
				<min>0</min>
				<tooltip textres="desktop_longrest" />
				<frame name="fieldlight" offset="8,5,8,4" />
				<stateframe>
					<hover name="fieldfocus" offset="8,5,8,4" />
				</stateframe>
				<script>
					local bIsbLong = false;

					function onInit()
						local sRuleset = User.getRulesetName();
						bIsbLong = sRuleset == "4E" or sRuleset == "5E" or sRuleset == "PFRPG" or sRuleset == "PFRPG2" or sRuleset == "3.5E"
						if bIsbLong then
							setValue(tonumber(OptionsManager.getOption(TimeManager.CLOCKADJUSTER_DEFAULT_LONG)) or 0);
							OptionsManager.registerCallback(TimeManager.CLOCKADJUSTER_DEFAULT_LONG, onOptionChanged);
						else
							setVisible(false);
 						end
					end
					
					function onOptionChanged()
						setValue(tonumber(OptionsManager.getOption(TimeManager.CLOCKADJUSTER_DEFAULT_LONG)) or 0);
					end

					function onDoubleClick()
						local nHours = getValue() or 0;
						local nRounds = nHours * 600;
						TimeManager.processTimeRoundsOption(nRounds);
						CalendarManager.adjustHours(getValue() or 0);
						TimeManager.checkAndOutputDate();
						TimeManager.checkAndProcessWeather(window.checkweather.getValue());
						CalendarManager.outputTime();
						ChatManager.Message(Interface.getString("ct_message_restlong") or Interface.getString("ct_message_restovernight") or Interface.getString("ct_message_restextended") or "Long Rest", true);
						if bIsbLong then
							CombatManager2.rest(true);
						end

						TimeManager.onUpdateAddControl();
					end
				</script>
			</basicnumber>
			
			<basicnumber name="shortrest">
				<anchored>
                    <left>
                        <parent>longrest</parent>
                        <anchor>right</anchor>
                        <offset>12</offset>
                    </left>
                    <top>
                        <parent>longrest</parent>
                        <anchor>top</anchor>
                        <offset>0</offset>
                    </top>
                    <size>
                        <width>20</width>
                        <height>16</height>
                    </size>
				</anchored>
				<min>0</min>
				<tooltip textres="desktop_shortrest" />
				<frame name="fieldlight" offset="8,5,8,4" />
				<stateframe>
					<hover name="fieldfocus" offset="8,5,8,4" />
				</stateframe>
				<script>
					local bIsbShort = false;

					function onInit()
						local sRuleset = User.getRulesetName();
						bIsbShort = sRuleset == "4E" or sRuleset == "5E" or sRuleset == "PFRPG" or sRuleset == "PFRPG2" or sRuleset == "3.5E" or sRuleset == "OSE2";
						if bIsbShort then
                            local nShortRestMinutes = tonumber(OptionsManager.getOption(TimeManager.CLOCKADJUSTER_DEFAULT_SHORT)) or 0;
                            if sRuleset == "OSE2" then
                                nShortRestMinutes = 10;
                            end
							setValue(nShortRestMinutes);
							OptionsManager.registerCallback(TimeManager.CLOCKADJUSTER_DEFAULT_SHORT, onOptionChanged);
						else
							setVisible(false);
 						end
					end

					function onOptionChanged()
                        local nShortRestMinutes = tonumber(OptionsManager.getOption(TimeManager.CLOCKADJUSTER_DEFAULT_SHORT)) or 0;
                        if sRuleset == "OSE2" then
                            nShortRestMinutes = 10;
                        end
                        setValue(nShortRestMinutes);
					end

					function onDoubleClick()
                        TimeManager.bShortRestDoubleClick = true;
						local nMinutes = getValue() or 0;
						local nRounds = nMinutes * 10;
						TimeManager.processTimeRoundsOption(nRounds);
						CalendarManager.adjustMinutes(getValue() or 0);
						TimeManager.checkAndOutputDate();
						CalendarManager.outputTime();
						ChatManager.Message(Interface.getString("ct_message_rest") or Interface.getString("menu_restshort"), true);
						if bIsbShort then
							CombatManager2.rest(false);
						end
						
						TimeManager.onUpdateAddControl();
                        TimeManager.bShortRestDoubleClick = false;
					end
				</script>
			</basicnumber>
			
			<buttoncontrol name="adv6am">
				<anchored>
                    <left>
                        <parent>shortrest</parent>
                        <anchor>right</anchor>
                        <offset>9</offset>
                    </left>
                    <top>
                        <parent>shortrest</parent>
                        <anchor>top</anchor>
                        <offset>-2</offset>
                    </top>
                    <size>
                        <width>20</width>
                        <height>20</height>
                    </size>
				</anchored>
				<icon normal="6AM_Dark" pressed="6AM_Dark_down" />
				<tooltip textres="desktop_adv6am_tooltip" />
				<script>
					function onButtonPress()
						TimeManager.advanceTime("6am", window);
					end
				</script>
			</buttoncontrol>
			<buttoncontrol name="adv12pm">
				<anchored>
                    <left>
                        <parent>adv6am</parent>
                        <anchor>right</anchor>
                        <offset>3</offset>
                    </left>
                    <top>
                        <parent>adv6am</parent>
                        <anchor>top</anchor>
                        <offset>0</offset>
                    </top>
                    <size>
                        <width>20</width>
                        <height>20</height>
                    </size>
				</anchored>
				<icon normal="12PM_Dark" pressed="12PM_Dark_down" />
				<tooltip textres="desktop_adv12pm_tooltip" />
				<script>
					function onButtonPress()
						TimeManager.advanceTime("12pm", window);
					end
				</script>
			</buttoncontrol>
			<buttoncontrol name="adv6pm">
				<anchored>
                    <left>
                        <parent>adv12pm</parent>
                        <anchor>right</anchor>
                        <offset>3</offset>
                    </left>
                    <top>
                        <parent>adv12pm</parent>
                        <anchor>top</anchor>
                        <offset>0</offset>
                    </top>
                    <size>
                        <width>20</width>
                        <height>20</height>
                    </size>
				</anchored>
				<icon normal="6PM_Dark" pressed="6PM_Dark_down" />
				<tooltip textres="desktop_adv6pm_tooltip" />
				<script>
					function onButtonPress()
						TimeManager.advanceTime("6pm", window);
					end
				</script>
			</buttoncontrol>
			<buttoncontrol name="adv12am">
				<anchored>
                    <left>
                        <parent>adv6pm</parent>
                        <anchor>right</anchor>
                        <offset>3</offset>
                    </left>
                    <top>
                        <parent>adv6pm</parent>
                        <anchor>top</anchor>
                        <offset>0</offset>
                    </top>
                    <size>
                        <width>20</width>
                        <height>20</height>
                    </size>
				</anchored>
				<icon normal="12AM_Dark" pressed="12AM_Dark_down" />
				<tooltip textres="desktop_adv12am_tooltip" />
				<script>
					function onButtonPress()
						TimeManager.advanceTime("12am", window);
					end
				</script>
			</buttoncontrol>
			<buttoncontrol name="openevents">
				<anchored>
                    <left>
                        <parent>adv12am</parent>
                        <anchor>right</anchor>
                        <offset>3</offset>
                    </left>
                    <top>
                        <parent>adv12am</parent>
                        <anchor>top</anchor>
                        <offset>0</offset>
                    </top>
                    <size>
                        <width>20</width>
                        <height>20</height>
                    </size>
				</anchored>
				<icon normal="add_logentry" pressed="add_logentry_down" />
				<tooltip textres="desktop_openevents_tooltip" />
				<script>
					function onButtonPress()
						if not Interface.findWindow("timedevents", "DB") then
							Interface.openWindow("timedevents", "DB");
						elseif Interface.findWindow("timedevents", "DB") then
							Interface.findWindow("timedevents", "DB").close();
						end
						
					end
				</script>
			</buttoncontrol>
			<buttoncontrol name="openreminders">
				<anchored>
                    <left>
                        <parent>openevents</parent>
                        <anchor>right</anchor>
                        <offset>3</offset>
                    </left>
                    <top>
                        <parent>openevents</parent>
                        <anchor>top</anchor>
                        <offset>0</offset>
                    </top>
                    <size>
                        <width>20</width>
                        <height>20</height>
                    </size>
				</anchored>
				<icon normal="reminder_button" pressed="reminder_button_down" />
				<tooltip textres="desktop_openreminders_tooltip" />
				<script>
					function onButtonPress()
						if not Interface.findWindow("timedreminders", "DB") then
							Interface.openWindow("timedreminders", "DB");
						elseif Interface.findWindow("timedreminders", "DB") then
							Interface.findWindow("timedreminders", "DB").close();
						end
						
					end
				</script>
			</buttoncontrol>
			<buttoncontrol name="opentravelmanager">
				<anchored>
                    <left>
                        <parent>openreminders</parent>
                        <anchor>right</anchor>
                        <offset>3</offset>
                    </left>
                    <top>
                        <parent>openreminders</parent>
                        <anchor>top</anchor>
                        <offset>0</offset>
                    </top>
                    <size>
                        <width>20</width>
                        <height>20</height>
                    </size>
				</anchored>
				<icon normal="atob_button" pressed="atob_button_down" />
				<tooltip textres="desktop_opentravel_tooltip" />
				<script>
					function onButtonPress()
						if not Interface.findWindow("travelmanager", "DB") then
							Interface.openWindow("travelmanager", "DB");
						elseif Interface.findWindow("travelmanager", "DB") then
							Interface.findWindow("travelmanager", "DB").close();
						end
					end
				</script>
			</buttoncontrol>
			<button_checkbox name="checkweather">
				<anchored>
                    <left>
                        <parent>opentravelmanager</parent>
                        <anchor>right</anchor>
                        <offset>1</offset>
                    </left>
                    <top>
                        <parent>opentravelmanager</parent>
                        <anchor>top</anchor>
                        <offset>1</offset>
                    </top>
                    <size>
                        <width>20</width>
                        <height>20</height>
                    </size>
				</anchored>
				<values>
					<maximum>1</maximum>
				</values>
				<tooltip text="Check Weather on Time Adjust; NOTE: You must have a table for each 'Weather - Wind', 'Weather - Temperature', and 'Weather - Precipitation'" />
				<script>
					function onInit()
						setValue(DB.getValue("calendar.lastcheckweather") or 0);
					end

					function onValueChanged()
						DB.setValue("calendar.lastcheckweather", "number", getValue());
					end
				</script>
			</button_checkbox>
		</sheetdata>
	</windowclass>

	<windowclass name="timedevents">
		<frame>recordsheet</frame>
		<placement>
			<size width="370" height="30" />
			<position x="260" y="30" />
		</placement>
		<sizelimits>
			<dynamic />
		</sizelimits>
		<nodelete />
		<softclose />
		<sheetdata>
			<windowtitlebar name="title">
				<resource>events_window_title</resource>
			</windowtitlebar>
			<windowlist name="eventslist">
				<anchored>
					<top offset="35" />
					<left offset="15" />
					<right offset="-15" />
					<bottom offset="-15" />
				</anchored>
				<sortby><control>year</control><control>month</control><control>day</control><control>hour</control><control>minute</control></sortby>
				<child><backcolor>1A40301E</backcolor></child>
				<datasource>.timedeventlist</datasource>
				<class>list_timedevent</class>
				<acceptdrop>
					<class>timedevent</class>
					<class>list_timedevent</class>
					<class>referencetext</class>
					<class>referencetextwide</class>
					<field>*</field>
				</acceptdrop>
				<empty font="reference-r" text="Right-click to add an event" hidereadonly="true" />
				<allowcreate />
				<allowdelete />
				<script>
					function onInit()
						DB.addHandler(TimeManager.CAL_CLOCKADJUSTERNOTIFY, "onUpdate", onTimeChanged);
					end

					function onClose()
						DB.removeHandler(TimeManager.CAL_CLOCKADJUSTERNOTIFY, "onUpdate", onTimeChanged);
					end

					function onTimeChanged()
						for _,w in pairs(getWindows()) do
							w.onTimeChanged();
						end
					end

					function update()
						onTimeChanged();
					end
				</script>
			</windowlist>
			<scrollbar>
				<anchored to="eventslist" />
				<target>eventslist</target>
			</scrollbar>
		</sheetdata>
		<dynamic />
	</windowclass>
	
	<windowclass name="list_timedevent">
		<margins control="0,0,0,2" />
		<softclose />
		<script>
			function update()
				windowlist.update();
				if not Session.IsHost then
					setVisible(false);
				end

				completed.setValue(0);
			end

			function onTimeChanged()
				local sName = name.getValue() or "";
				local nCompleted = completed.getValue();
				local nVisibleAll = isgmonly.getValue();
				local nEventMinute = minute.getValue() or 0;
				local nEventHour = hour.getValue() or 0;
				local nEventDay = day.getValue() or 0;
				local nEventMonth = month.getValue() or 0;
				local nEventYear = year.getValue() or 0;
				local nodeDB = getDatabaseNode();
				if TimeManager.onTimeChangedEvent(nodeDB, sName, nCompleted, nVisibleAll, nEventMinute, nEventHour, nEventDay, nEventMonth, nEventYear) == 1 then
					completed.setValue(1);
				end
			end
		</script>
		<sheetdata>
			<genericcontrol name="rightanchor">
				<anchored width="0" height="0">
					<top />
					<right />
				</anchored>
				<invisible />
			</genericcontrol>
			<button_idelete name="idelete">
				<anchored width="20" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
				</anchored>
			</button_idelete>
			<linkcontrol name="shortcut">
				<anchored width="20" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-2" />
				</anchored>
				<class>timedevent</class>
				<readonly />
			</linkcontrol>
			<buttonfield name="isgmonly">
				<anchored width="20" height="20">
					<top offset="3" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
				</anchored>
				<gmvisibleonly />
				<state icon="visibilityoff" tooltipres="visibilityoff" />
				<state icon="visibilityon" tooltipres="visibilityon" />
			</buttonfield>
			<buttongroup_counter name="completedbutton">
				<anchored width="20" height="20">
					<top offset="3" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
				</anchored>
				<sourcefields>
					<current>completed</current>
				</sourcefields>
				<values>
					<maximum>1</maximum>
				</values>
				<tooltip text="Completed" />
				
			</buttongroup_counter>
			<basicnumber name="completed" source="completed">
				<anchored width="40" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<delaykeyupdate />
				<tabtarget prev="location" />
				<invisible />
			</basicnumber>
			<basicnumber name="year" source="year">
				<anchored width="40" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<delaykeyupdate />
				<tabtarget prev="location" />
				<tooltip textres="year_tooltip" />
			</basicnumber>
			
			<basicnumber name="month" source="month">
				<anchored width="20" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<delaykeyupdate />
				<tooltip textres="month_tooltip" />
			</basicnumber>
			<basicnumber name="day" source="day">
				<anchored width="20" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<delaykeyupdate />
				<tooltip textres="day_tooltip" />
			</basicnumber>
			<basicnumber name="minute" source="minute">
				<anchored width="20" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<delaykeyupdate />
				<tooltip textres="minute_tooltip" />
			</basicnumber>
			<basicnumber name="hour" source="hour">
				<anchored width="20" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<delaykeyupdate />
				<tooltip textres="hour_tooltip" />
			</basicnumber>
			<stringu name="name">
				<anchored height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
					<left offset="10" />
				</anchored>
				<tabtarget next="nonid_name" prev="count" />
			</stringu>
		</sheetdata>
	</windowclass>
	
	<windowclass name="timedevent">
		<frame>referencepage</frame>
		<placement>
			<size width="400" height="350" />
		</placement>
		<sizelimits>
			<dynamic />
		</sizelimits>
		<minimize>minimized_reference</minimize>
		<tooltip field="value" />
		<softclose />
		<sharable />
		<script>
			function onLockChanged()
				local bReadOnly = WindowManager.getReadOnlyState(getDatabaseNode());
				text.setReadOnly(bReadOnly);
				hour.setReadOnly(bReadOnly);
				minute.setReadOnly(bReadOnly);
				day.setReadOnly(bReadOnly);
				month.setReadOnly(bReadOnly);
				year.setReadOnly(bReadOnly);
				isgmonly.setReadOnly(bReadOnly);
			end
		</script>
		<sheetdata>
			<sub_record_header name="header">
				<class>timedevents_header</class>
			</sub_record_header>

			<frame_record_content name="contentframe" />
			<basicnumber name="hour" source="hour">
				<anchored width="20" height="20">
					<top parent="header" anchor="bottom" offset="10" />
					<left offset="80" />
				</anchored>
				<delaykeyupdate />
				<tabtarget prev="location" />
				<tooltip textres="hour_tooltip" />
			</basicnumber>
			
			<basicnumber name="minute" source="minute">
				<anchored to="hour" width="20" height="20">
					<top />
					<left parent="hour" anchor="right" offset="10" />
				</anchored>
				<delaykeyupdate />
				<tabtarget prev="location" />
				<tooltip textres="minute_tooltip" />
			</basicnumber>
			<basicnumber name="day" source="day">
				<anchored to="minute" width="20" height="20">
					<top />
					<left parent="minute" anchor="right" offset="10" />
				</anchored>
				<delaykeyupdate />
				<tabtarget prev="location" />
				<tooltip textres="day_tooltip" />
			</basicnumber>
			<basicnumber name="month" source="month">
				<anchored to="day" width="20" height="20">
					<top />
					<left parent="day" anchor="right" offset="10" />
				</anchored>
				<delaykeyupdate />
				<tabtarget prev="location" />
				<tooltip textres="month_tooltip" />
			</basicnumber>
			<basicnumber name="year" source="year">
				<anchored to="month" width="40" height="20">
					<top />
					<left parent="month" anchor="right" offset="10" />
				</anchored>
				<delaykeyupdate />
				<tabtarget prev="location" />
				<tooltip textres="year_tooltip" />
			</basicnumber>
			<buttonfield name="isgmonly">
				<anchored to="year" width="40" height="20">
					<top />
					<left parent="year" anchor="right" offset="10" />
				</anchored>
				<gmvisibleonly />
				<state icon="visibilityoff" tooltipres="visibilityoff" />
				<state icon="visibilityon" tooltipres="visibilityon" />
			</buttonfield>
			<buttoncontrol name="openlogentry">
				<anchored to="isgmonly" position="right" offset="3,0" width="20" height="20" />
				<icon normal="add_logentry" pressed="add_logentry_down" />
				<tooltip textres="desktop_openlog_tooltip" />
				<script>
					function onButtonPress()
						local nMonth = window.month.getValue() or 0;
						local nDay = window.day.getValue() or 0;
						local nYear = window.year.getValue() or 0;
						local bGMVisible = window.isgmonly.getValue() == 0;
						local nodeDB = window.getDatabaseNode();
						local sName = DB.getValue(nodeDB, "name", "");
						TimeManager.addLogEntry(nMonth, nDay, nYear, bGMVisible, nodeDB);
					end
				</script>
			</buttoncontrol>
			<button_text name="button_viewall">
				<anchored to="openlogentry" position="righthigh" offset="5,0" width="70" height="20" />
				<state text="View Logs" />
				<script>
					function onButtonPress()
						Interface.openWindow("loglist", "calendar.log");
					end
				</script>
			</button_text>
			
			<ft_record name="text">
				<anchored>
					<top offset="110" />
					<left offset="30" />
					<right offset="-30" />
					<bottom offset="-30" />
				</anchored>
				<empty textres="ft_empty" hidereadonly="true" />
			</ft_record>
			<scrollbar_record>
				<target>text</target>
			</scrollbar_record>
			
			<resize_referencepage />
			<close_referencepage />
		</sheetdata>
	</windowclass>
	
	<windowclass name="timedevents_header">
		<margins control="0,0,0,7" />
		<softclose />
		<sheetdata>
			<link_record_header>
				<class>timedevent</class>
				<description field="name" />
			</link_record_header>

			<anchor_record_header_right name="rightanchor" />
			<icon_record_locked />
			<button_record_locked />

			<string_record_name name="name" />
		</sheetdata>
	</windowclass>
	
	<windowclass name="travelmanager">
		<frame>recordsheet</frame>
		<size width="250" height="200" />
		<placement>
			<position x="10" y="30" />
			<size width="250" height="200" />
		</placement>		
		<sizelimits>
			<maximum width="250" height="200" />
		</sizelimits>		
		<nodelete />
		<softclose />
		<resize />
		<sheetdata>
			<label name="traveledlabel">
				<anchored position="insidetopleft" offset="10,10" height="20" width="70" />
				<static text="Traveled" />
			</label>
			<label name="totallabel">
				<anchored to="traveledlabel" position="belowleft" offset="0,10" height="20" width="70" />
				<static text="Distance:" />
			</label>
			<label name="remaininglabel">
				<anchored to="totallabel" position="belowleft" offset="0,10" height="20" width="70" />
				<static text="Remaining:" />
			</label>
			<label name="travelspeedlabel">
				<anchored to="remaininglabel" position="belowleft" offset="0,10" height="20" width="70" />
				<static text="Speed:" />
			</label>
			<label name="travelbylabel">
				<anchored to="travelspeedlabel" position="belowleft" offset="0,10" height="20" width="70" />
				<static text="Travel by:" />
			</label>
			<simplenumber name="distanceremaining" source="distance.remaining">
				<anchored to="remaininglabel" position="righthigh" height="20" width="20" offset="5" />
				<tooltip text="Distance Remaining" />
				<script>
					function onInit()
						DB.addHandler("distance.traveled", "onUpdate", calculateDistanceRemaining);
						DB.addHandler("distance.destination", "onUpdate", calculateDistanceRemaining);
					end

					function onClose()
						DB.removeHandler("distance.traveled", "onUpdate", calculateDistanceRemaining);
						DB.removeHandler("distance.destination", "onUpdate", calculateDistanceRemaining);
					end

					function calculateDistanceRemaining()
						local nDistance = window.destination.getValue() or 0;
						local nDistanceTraveled = window.distancetraveled.getValue() or 0;
						local nDistanceRemaining = nDistance - nDistanceTraveled;
						setValue(nDistanceRemaining);
					end

					function onValueChanged()
						local nDistance = window.destination.getValue() or 0;
						local nDistanceTraveled = window.distancetraveled.getValue() or 0;
						nDistanceRemaining = nDistance - nDistanceTraveled;
						DB.setValue("distance.remaining", "number", nDistanceRemaining);
					end
				</script>
				<readonly />
			</simplenumber>
			
			<basicnumber name="distancetraveled" source="distance.traveled">
				<anchored to="traveledlabel" position="righthigh" height="20" width="20" offset="5" />
				<delaykeyupdate />
				<tooltip text="Distance Traveled" />
				<script>
					function onValueChanged()
						DB.setValue("distance.traveled", "number", getValue() or 0);
					end
				</script>
			</basicnumber>
			<basicnumber name="destination" source="distance.destination">
				<anchored to="totallabel" position="righthigh" height="20" width="20" offset="5" />
				<delaykeyupdate />
				<tooltip text="Total Travel Distance" />
				<script>
					function onValueChanged()
						DB.setValue("distance.destination", "number", getValue() or 0);
					end
				</script>
			</basicnumber>
			<buttoncontrol name="destinationmeasurement">
				<anchored height="30" width="60">
					<left parent="destination" anchor="right" offset="10" />
					<top parent="destination" anchor="top" />
				</anchored>
				<tooltip text="Distance in Miles/Kilometers" />
				<state text="Mile(s)" />
				<state text="Kilometer(s)" />
				<default>0</default>
				<sourcefields>
					<current>distance.speedunit</current>
				</sourcefields>
				<frame name="fielddark" offset="0,0,0,0" />
				<script>
					function onValueChanged()
						DB.setValue("distance.speedunit", "number", getValue() or 0);
						window.unitofmeasurement.setValue(getValue() or 0);
					end
				</script>
			</buttoncontrol>
			<basicnumber name="travelspeed" source="distance.speed">
				<anchored to="travelspeedlabel" position="righthigh" height="20" width="20" offset="5" />
				<tooltip text="Speed" />
				<default>6</default>
				<script>
					function onValueChanged()
						DB.setValue("distance.speed", "number", getValue() or 6);
					end
				</script>
			</basicnumber>
			
			<buttoncontrol name="unitofmeasurement">
				<anchored height="30" width="60">
					<left parent="travelspeed" anchor="right" offset="10" />
					<top parent="travelspeed" anchor="top" />
				</anchored>
				<state text="Mile(s)" />
				<state text="Kilometer(s)" />
				<default>0</default>
				<sourcefields>
					<current>distance.speedunit</current>
				</sourcefields>
				<frame name="fielddark" offset="0,0,0,0" />
				<tooltip text="Length Factor of Speed" />
				<script>
					function onValueChanged()
						DB.setValue("distance.speedunit", "number", getValue() or 0);
						window.destinationmeasurement.setValue(getValue() or 0);
					end
				</script>
			</buttoncontrol>
			<buttoncontrol name="perlimit">
				<anchored height="30" width="60">
					<left parent="unitofmeasurement" anchor="right" offset="0" />
					<top parent="unitofmeasurement" anchor="top" />
				</anchored>
				<tooltip text="Time Factor of Speed" />
				<state text="/hour" />
				<state text="/day" />
				<default>1</default>
				<sourcefields>
					<current>distance.perlimit</current>
				</sourcefields>
				<frame name="fielddark" offset="0,0,0,0" />
				<script>
					function onValueChanged()
						DB.setValue("distance.perlimit", "number", getValue() or 0);
						window.traveltime.setValue(getValue() or 0);
					end
				</script>
			</buttoncontrol>
			<basicnumber name="travelbyhours" source="travel.byhours">
				<anchored to="travelbylabel" position="righthigh" height="20" width="20" offset="5" />
				<tooltip text="Travel by # of Hours/Days" />
				<script>

					function onDoubleClick()
						TimeManager.TravelByPace(window);
                        TimeManager.bTimeAdvancedByAdvanceTimeButtonPress = false;
					end
				</script>
			</basicnumber>
			<buttoncontrol name="traveltime">
				<anchored height="30" width="60">
					<left parent="travelbyhours" anchor="right" offset="0" />
					<top parent="travelbyhours" anchor="top" />
				</anchored>
				<tooltip text="" />
				<state text="hours" />
				<state text="days" />
				<default>1</default>
				<sourcefields>
					<current>distance.perlimit</current>
				</sourcefields>
				<script>
					function onValueChanged()
						DB.setValue("distance.perlimit", "number", getValue());
						window.perlimit.setValue(getValue());
					end
				</script>
			</buttoncontrol>
			<buttonfield name="isgmonly">
				<anchored height="20" width="50">
					<left parent="traveltime" anchor="right" offset="0" />
					<top parent="traveltime" anchor="top" />
				</anchored>
				<gmvisibleonly />
				<state icon="visibilityoff" tooltipres="visibilityoff" />
				<state icon="visibilityon" tooltipres="visibilityon" />
			</buttonfield>
			
			<label name="travellabel">
				<anchored to="travelbylabel" position="belowleft" offset="0,10" height="20" width="70" />
				<static text="Travel" />
			</label>
			<buttoncontrol name="travel">
				<anchored to="travellabel" position="righthigh" offset="0,0" width="20" height="20" />
				<icon normal="atob_button" pressed="atob_button_down" />
				<tooltip text="Travel" />
				<script>
					function onButtonPress()
						TimeManager.TravelByPace(window);
					end
				</script>
			</buttoncontrol>
			<buttoncontrol name="slowtravel">
				<anchored to="travel" position="righthigh" offset="0,0" width="20" height="20" />
				<icon normal="atob_button" pressed="atob_button_down" />
				<tooltip text="Click to Travel at a Slow Pace; NOTE: You must have a table named 'Encounter Chance Slow Travel Pace'" />
				<script>
					function onButtonPress()
						TimeManager.TravelByPace(window);

						local EncounterChance = "Encounter Chance Slow Travel Pace";
						if window.encounterchance.getValue() == 1 then
							TableManager.processTableRoll("", EncounterChance);
						end
					end
				</script>
			</buttoncontrol>
			<buttoncontrol name="normaltravel">
				<anchored to="slowtravel" position="righthigh" offset="0,0" width="20" height="20" />
				<icon normal="atob_button" pressed="atob_button_down" />
				<tooltip text="Click to Travel at a Normal Pace; NOTE: You must have a table named 'Encounter Chance Normal Travel Pace'" />
				<script>
					function onButtonPress()
						TimeManager.TravelByPace(window);

						local EncounterChance = "Encounter Chance Normal Travel Pace";
						if window.encounterchance.getValue() == 1 then
							TableManager.processTableRoll("", EncounterChance);
						end
					end
				</script>
			</buttoncontrol>
			<buttoncontrol name="fasttravel">
				<anchored to="normaltravel" position="righthigh" offset="0,0" width="20" height="20" />
				<icon normal="atob_button" pressed="atob_button_down" />
				<tooltip text="Click to Travel at a Fast Pace; NOTE: You must have a table named 'Encounter Chance Fast Travel Pace'" />
				<script>
					function onButtonPress()
						TimeManager.TravelByPace(window);

						local EncounterChance = "Encounter Chance Fast Travel Pace";
						if window.encounterchance.getValue() == 1 then
							TableManager.processTableRoll("", EncounterChance);
						end
					end
				</script>
			</buttoncontrol>
			<button_checkbox name="encounterchance">
				<anchored width="20" height="20">
					<top parent="fasttravel" anchor="top" offset="0" />
					<right parent="fasttravel" anchor="right" offset="15" />
				</anchored>
				<values>
					<maximum>1</maximum>
				</values>
				<tooltip text="Rolls an encounter chance when using Travel Speed Buttons to the left; Note: Looks for tablenames: Encounter Chance Slow Travel Pace, Encounter Chance Normal Travel Pace, or Encounter Chance Fast Travel Pace" />
				
			</button_checkbox>
		</sheetdata>
	</windowclass>
	
	<windowclass name="timedreminders">
		<frame>recordsheet</frame>
		<placement>
			<size width="370" height="30" />
			<position x="260" y="30" />
		</placement>
		<sizelimits>
			<dynamic />
		</sizelimits>
		<nodelete />
		<softclose />
		<sheetdata>
			<windowtitlebar name="title">
				<resource>reminders_window_title</resource>
			</windowtitlebar>
			<windowlist name="reminderslist">
				<anchored>
					<top offset="35" />
					<left offset="15" />
					<right offset="-15" />
					<bottom offset="-15" />
				</anchored>
				<sortby><control>name</control></sortby>
				<child><backcolor>1A40301E</backcolor></child>
				<datasource>.timedreminderlist</datasource>
				<class>list_timedreminder</class>
				<empty font="reference-r" text="Right-click to add an reminder" hidereadonly="true" />
				<acceptdrop>
					<class>timedreminder</class>
					<class>list_timedreminder</class>
					<class>referencetext</class>
					<class>referencetextwide</class>
					<field>*</field>
				</acceptdrop>
				<allowcreate />
				<allowdelete />
				<script>
					function onInit()
						DB.addHandler(TimeManager.CAL_CLOCKADJUSTERNOTIFY, "onUpdate", onTimeChanged);
					end

					function onClose()
						DB.removeHandler(TimeManager.CAL_CLOCKADJUSTERNOTIFY, "onUpdate", onTimeChanged);
					end

					function onTimeChanged()
						for _, w in pairs(getWindows()) do
							w.onTimeChanged();
						end
					end

					function update()
						onTimeChanged();
					end
				</script>
			</windowlist>
			<scrollbar>
				<anchored to="reminderslist" />
				<target>reminderslist</target>
			</scrollbar>
		</sheetdata>
		<dynamic />
	</windowclass>
	
	<windowclass name="list_timedreminder">
		<margins control="0,0,0,2" />
		<softclose />
		<script>
			function update()
				windowlist.update();
				if not Session.IsHost then
					setVisible(false);
				end

				completed.setValue(0);
			end

			function onTimeChanged()
				local nodeReminder = getDatabaseNode();
				local sName = name.getValue() or "";
				local nRepeatTime = repeattime.getValue();
				local nReminderCycle = remindercycle.getValue() or 0;
				local nVisible = isgmonly.getValue();
				local nActive = active.getValue();
				TimeManager.onTimeChangedReminder(nodeReminder, sName, nRepeatTime, nReminderCycle, nVisible, nActive);
			end
		</script>
		<sheetdata>
			<genericcontrol name="rightanchor">
				<anchored width="0" height="0">
					<top />
					<right />
				</anchored>
				<invisible />
			</genericcontrol>
			<button_idelete name="idelete">
				<anchored width="20" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
				</anchored>
			</button_idelete>
			<linkcontrol name="shortcut">
				<anchored width="20" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-2" />
				</anchored>
				<class>timedreminder</class>
				<readonly />
			</linkcontrol>
			<buttongroup_counter name="activebutton">
				<anchored width="20" height="20">
					<top offset="3" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
				</anchored>
				<sourcefields>
					<current>active</current>
				</sourcefields>
				<values>
					<maximum>1</maximum>
				</values>
				<tooltip text="Active" />
			</buttongroup_counter>
			<basicnumber name="active" source="active">
				<anchored width="40" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<script>
					function onValueChanged()
						if window.active.getValue() == 1 then
							local nodeReminder = window.getDatabaseNode();
							TimeManager.setStartTimeComponents(nodeReminder);
						end
					end
				</script>
				<invisible />
			</basicnumber>
			<buttonfield name="isgmonly">
				<anchored width="20" height="20">
					<top offset="3" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
				</anchored>
				<gmvisibleonly />
				<state icon="visibilityoff" tooltipres="visibilityoff" />
				<state icon="visibilityon" tooltipres="visibilityon" />
			</buttonfield>
			<basicnumber name="remindercycle" source="remindercycle">
				<anchored width="40" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<delaykeyupdate />
				<tabtarget prev="location" />
				<tooltip textres="remindercycle_tooltip" />
			</basicnumber>
			<buttoncontrol name="repeattimebutton" source="repeattime">
				<anchored width="60" height="30">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<tooltip text="Remind every number of minutes/hours/days" />
				<state text="minutes" />
				<state text="hours" />
				<state text="days" />
				<default>0</default>
				<sourcefields>
					<current>.repeattime</current>
				</sourcefields>
				<script>
					function onInit()
						local nodeReminder = window.getDatabaseNode();
						setValue(DB.getValue(nodeReminder, "repeattime", 0));
					end

					function onButtonPress()
						local nodeReminder = window.getDatabaseNode();
						DB.setValue(nodeReminder, "repeattime", "number", getValue());
						window.repeattime.setValue(getValue());
					end
				</script>
			</buttoncontrol>
			<basicnumber name="repeattime" source="repeattime">
				<anchored width="40" height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
				</anchored>
				<script>
					function onInit()
						local nodeReminder = window.getDatabaseNode();
						setValue(DB.getValue(nodeReminder, "repeattime", 0));
					end

					function onValueChanged()
						local nodeReminder = window.getDatabaseNode();
						DB.setValue(nodeReminder, "repeattime", "number", getValue());
						window.repeattimebutton.setValue(getValue());
					end
				</script>
				<invisible />
			</basicnumber>
			<stringu name="name">
				<anchored height="20">
					<top offset="2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-10" />
					<left offset="10" />
				</anchored>
				<tabtarget next="nonid_name" prev="count" />
			</stringu>
		</sheetdata>
	</windowclass>
	
	<windowclass name="timedreminder">
		<frame>referencepage</frame>
		<placement>
			<size width="400" height="350" />
		</placement>
		<sizelimits>
			<dynamic />
		</sizelimits>
		<minimize>minimized_reference</minimize>
		<tooltip field="value" />
		<softclose />
		<sharable />
		<script>
			function onLockChanged()
				local bReadOnly = WindowManager.getReadOnlyState(getDatabaseNode());
				remindercycle.setReadOnly(bReadOnly);
				repeattime.setReadOnly(bReadOnly);
				repeattimebutton.setReadOnly(bReadOnly);
				text.setReadOnly(bReadOnly);
				isgmonly.setReadOnly(bReadOnly);
			end
		</script>
		<sheetdata>
			<sub_record_header name="header">
				<class>timedreminders_header</class>
			</sub_record_header>

			<frame_record_content name="contentframe" />
			<label name="reminderlabel">
				<anchored>
					<top parent="header" anchor="bottom" offset="10" />
					<left offset="40" />
				</anchored>
				<static text="Remind every" />
			</label>
			<basicnumber name="remindercycle" source="remindercycle">
				<anchored width="20" height="20">
					<top parent="header" anchor="bottom" offset="10" />
					<left parent="reminderlabel" anchor="right" offset="10" />
				</anchored>
				<delaykeyupdate />
				<tooltip textres="remindercycle_tooltip" />
			</basicnumber>
			
			<basicnumber name="repeattime" source="repeattime">
				<anchored to="remindercycle" width="30" height="30">
					<top />
					<left parent="remindercycle" anchor="right" offset="10" />
				</anchored>
				<script>
					function onInit()
						local nodeReminder = window.getDatabaseNode();
						setValue(DB.getValue(nodeReminder, "repeattime", 0));
					end

					function onValueChanged()
						local nodeReminder = window.getDatabaseNode();
						DB.setValue(nodeReminder, "repeattime", "number", getValue());
						window.repeattimebutton.setValue(getValue());
					end
				</script>
				<invisible />
			</basicnumber>
			<buttoncontrol name="repeattimebutton" source="repeattime">
				<anchored to="repeattime" width="60" height="20">
					<top />
					<left parent="repeattime" anchor="right" offset="10" />
				</anchored>
				<tooltip text="Remind every number of minutes/hours/days" />
				<state text="minutes" />
				<state text="hours" />
				<state text="days" />
				<default>0</default>
				<sourcefields>
					<current>reminder.repeattime</current>
				</sourcefields>
				<script>
					function onInit()
						local nodeReminder = window.getDatabaseNode();
						setValue(DB.getValue(nodeReminder, "repeattime", 0));
					end

					function onButtonPress()
						local nodeReminder = window.getDatabaseNode();
						DB.setValue(nodeReminder, "repeattime", "number", getValue());
						window.repeattime.setValue(getValue());
					end
				</script>
			</buttoncontrol>
			<buttonfield name="isgmonly">
				<anchored to="repeattimebutton" width="40" height="20">
					<top />
					<left parent="repeattimebutton" anchor="right" offset="10" />
				</anchored>
				<gmvisibleonly />
				<state icon="visibilityoff" tooltipres="visibilityoff" />
				<state icon="visibilityon" tooltipres="visibilityon" />
			</buttonfield>
			<ft_record name="text">
				<anchored>
					<top offset="110" />
					<left offset="30" />
					<right offset="-30" />
					<bottom offset="-30" />
				</anchored>
				<empty textres="ft_empty" hidereadonly="true" />
			</ft_record>
			<scrollbar_record>
				<target>text</target>
			</scrollbar_record>
			<playerowned />
			<resize_referencepage />
			<close_referencepage />
		</sheetdata>
	</windowclass>
	
	<windowclass name="timedreminders_header">
		<margins control="0,0,0,7" />
		<sheetdata>
			<link_record_header>
				<class>timedreminder</class>
				<description field="name" />
			</link_record_header>
			
			<anchor_record_header_right name="rightanchor" />
			<icon_record_locked />
			<button_record_locked />
			
			<string_record_name name="name" />
		</sheetdata>
	</windowclass>
</root>